import React, {Component} from 'react';
import { Grid, Row, Col } from 'react-flexbox-grid/lib/index'
import VulnerabilityTable from './VulnerabilityTable'
import VulnerabilityDialog from './VulnerabilityDialog'
import { fetchVulnerabilitiesIfNeeded, fetchVulnerabilities, selectPage } from '../../actions/vulnerability'
import { toggleVulnerabilityDialog } from '../../actions/vulnerability'

const  gridStyle = {width: "100%"};

class VulnerabilityList extends Component {
	componentDidMount() {
	    const { dispatch, page } = this.props
	    dispatch(fetchVulnerabilitiesIfNeeded(page))
	  }
	
	  componentWillReceiveProps(nextProps) {
		  if (this.props.page.current != nextProps.page.current) {
			  const { dispatch, page } = nextProps
			  dispatch(fetchVulnerabilities(page))
	  	  }
	  }

	  handleClick = newPage => {
	    this.props.dispatch(selectPage(newPage))
	  }
	  onVulnerabilitySelect = vuln => {
		  this.props.dispatch(toggleVulnerabilityDialog(true, vuln))
	  }

	  onDialogClose = () => {
		  this.props.dispatch(toggleVulnerabilityDialog(false, {}))
	  }

	render() {
		 const { items, page, dialog } = this.props

		 return (
		  <div>
		  	  <VulnerabilityDialog dialog={dialog} onClose={this.onDialogClose} />
		  	  <Grid style={gridStyle}>
		        <Row>
		          <h1>Known Vulnerabilities</h1>
			      <VulnerabilityTable vulnerabilities={items} page={page} onPageChange={this.handleClick} onVulnerabilitySelect={this.onVulnerabilitySelect} />
			    </Row>
		      </Grid>
	      </div>
		)

	}
}

export default VulnerabilityList